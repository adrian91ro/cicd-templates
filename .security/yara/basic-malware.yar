rule Suspicious_Shell_Patterns {
  meta:
    description = "Detect common shell-based malware delivery patterns"
    author = "cicd-templates"
  strings:
    $curl_bash = /curl\s+[^|]+\|\s*(bash|sh)/ nocase
    $wget_bash = /wget\s+[^|]+\|\s*(bash|sh)/ nocase
    $nc_shell = /nc\s+-e\s+\/bin\/(sh|bash)/ nocase
    $base64_exec = /base64\s+-d[^\n]{0,200}\|\s*(bash|sh)/ nocase
  condition:
    any of them
}

rule Suspicious_Powershell_Patterns {
  meta:
    description = "Detect common encoded/in-memory PowerShell execution patterns"
    author = "cicd-templates"
  strings:
    $ps_enc = /powershell(\.exe)?\s+[^\n]{0,200}-enc(odedcommand)?\s+/ nocase
    $iex_web = /IEX\s*\(\s*New-Object\s+Net\.WebClient\)/ nocase
  condition:
    any of them
}
